apply plugin: 'cpp'

model {
	toolChains {
		gcc(Gcc) {
		   target("arm") {
				cppCompiler.withArguments { args ->
                    args << "-m64"
                }
                linker.withArguments { args ->
                    args << "-m64"
                }
				cCompiler.executable 'arm-unknown-linux-gnueabi-g++'
				cppCompiler.executable 'arm-unknown-linux-gnueabi-g++'
				linker.executable 'arm-unknown-linux-gnueabi-g++'
				assembler.executable 'arm-unknown-linux-gnueabi-as'
				staticLibArchiver.executable 'arm-unknown-linux-gnueabi-ar'
		   }
		}
	}
	platforms {
	    arm {
		    architecture "armv71"
		}
	}
	components {
		main(NativeExecutableSpec) {
		   targetPlatform "arm"
		   binaries.all {
		     linker.args '-pthread'
		   }
		}
	}
}

tasks.build.doFirst {
	exec {
		commandLine "perl", "-w", "-e", "s/[BUILD_NUMBER]/"+project.buildnumber+"/g", "/src/main/cpp/Main.cpp"
	}
}